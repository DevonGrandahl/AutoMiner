<html>
	<script src="perlin.js"></script>
	<script>
		var smoothness = 15; // Noise Scale. Lower numbers give more peaks.
		var width = 20;
		var height = 30;
		
		var mineData = [];
		var tableString = "";
		
		var tileTypes = [
			{name: 'Dirt', color: '#52240c', value: 1, rarity: 0, minDepth: 0, maxDepth: 99},
			{name: 'DarkDirt', color: '#502008', value: 1, rarity: .6, minDepth: 0, maxDepth: 99},
			{name: 'EmptyDirt', color: '#200701', value: 1, rarity: 1, minDepth: 0, maxDepth: 99},
			{name: 'Grass', color: '#6cd900', value: 0, rarity: 0, minDepth: 0, maxDepth: 0},
			{name: 'Copper', color: '#da8a67', value: 1, rarity: .8, minDepth: 3, maxDepth: 16},
			{name: 'Silver', color: '#bbbbcc', value: 2, rarity: .88, minDepth: 20, maxDepth: 99},
			{name: 'Gold', color: '#cccc33', value: 3, rarity: .9, minDepth: 30, maxDepth: 99},
			{name: 'Diamond', color: '#cfe4ee', value: 5, rarity: .96, minDepth: 35, maxDepth: 99}
		];
		
		function getTypeFromName(name){
			return tileTypes.find( (e) => {return e.name == name;} )
		}
		
		function generateMine(){
			tileTypes.forEach( (type) => {
				noise.seed(Math.random());
				for (var h = 0; h < height; h++) {
					if (!mineData[h]){
						mineData[h] = [];
					}
					
					for (var w = 0; w < width; w++) {
						if (h >= type.minDepth && 
							h <= type.maxDepth && 
							Math.abs(noise.simplex2(h / smoothness, w / smoothness)) >= type.rarity
						){
							mineData[h][w] = type;
						}
					}
				}
			});
			drawTable();
		}

		function drawTable(){
			tableString = "<tr>";

			for (var h = 0; h < height; h++) {
			  for (var w = 0; w < width; w++) {
				type = mineData[h][w];
				tableString += getCellString(h, w, type);
			  }
			  tableString += "</tr><tr>";
			}
			tableString+= "</tr>";
			document.getElementById("table").innerHTML = tableString;
		}
		
		function getCellString(h, w, type){
			//return "<td style='width: 10px; height: 10px; background: " + type.color + "'>" + "" + "</td>";
			var styleString = "width: 20px; height: 20px; background-color: " + type.color + "; color: white"
			return "<td" + 
			" id='" + h + "_" + w + "'" +
			" style='" + styleString + "'" +
			" title='" + type.name + "'" +
			" onClick='handleClick(" + h + ", " + w + ")'" +
			">" +
			'' + 
			"</td>";
		}
		
		function handleClick(h, w){
			mineData[h][w] = getTypeFromName("EmptyDirt");
			drawTable();
		}
	
		
		
	</script>
	<body onload="generateMine();">
		<table cellspacing="0" style="padding:0px;" id="table">
		</table>
	</body>
</html>
